# -*- coding: utf-8 -*-
"""MLP.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/12vto6LcNf8EWP2EeBzBDvdTYnDiyIYnw
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import warnings


warnings.filterwarnings('ignore')

from sklearn.model_selection import StratifiedKFold
from sklearn.model_selection import GridSearchCV
from sklearn.neural_network import MLPClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import roc_auc_score, accuracy_score, precision_score, recall_score, f1_score
from sklearn.preprocessing import StandardScaler
from imblearn.over_sampling import SMOTE
from imblearn.pipeline import Pipeline
from sklearn.model_selection import learning_curve

from google.colab import files
uploaded = files.upload()

df = pd.read_csv('df_cleann.csv')

df.info()

X = df.drop(columns=["Depression"])
y = df["Depression"]

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

Train_df = pd.concat([X_train, y_train], axis=1)
Test_df = pd.concat([X_test, y_test], axis=1)

Train_df.to_csv('Train_df.csv', index=False)
Test_df.to_csv('Test_df.csv', index=False)

pipeline = Pipeline(steps=[
  ('scaler', StandardScaler()),
  ('smote', SMOTE()),
  ('model', MLPClassifier(
    max_iter=800,
    early_stopping=True,
    n_iter_no_change=20
))])

"""MLP1 = 128, 64, 32"""

X = Train_df.drop(columns=["Depression"])
y = Train_df["Depression"]

pipelineMLP1 = Pipeline(steps=[
  ('scaler', StandardScaler()),
  ('smote', SMOTE()),
  ('model', MLPClassifier(
    hidden_layer_sizes=(128, 64, 32),
    batch_size=64,
    max_iter=800,
    alpha=0.01,
    activation='logistic',
    learning_rate_init=0.0001,
    early_stopping=True,
    n_iter_no_change=20)
  )])

kfold = StratifiedKFold(n_splits=10, shuffle=True, random_state=42)

accuracy_scores = []
precision_scores = []
recall_scores = []
f1_scores = []

for train_index, test_index in kfold.split(X, y):
    X_train, X_test = X.iloc[train_index], X.iloc[test_index]
    y_train, y_test = y.iloc[train_index], y.iloc[test_index]

    pipelineMLP1.fit(X_train, y_train)
    predictions = pipelineMLP1.predict(X_test)

    accuracy_scores.append(accuracy_score(y_test, predictions))
    precision_scores.append(precision_score(y_test, predictions, average='macro'))
    recall_scores.append(recall_score(y_test, predictions, average='macro'))
    f1_scores.append(f1_score(y_test, predictions, average='macro'))

print("Resultados das métricas por fold:")
print("-----------------------------------")

for i in range(10):
  print(f"Fold {i+1}:")
  print(f"  Accuracy : {accuracy_scores[i]:.4f}")
  print(f"  Precision: {precision_scores[i]:.4f}")
  print(f"  Recall   : {recall_scores[i]:.4f}")
  print(f"  F1-Score : {f1_scores[i]:.4f}")
  print("-----------------------------------")

print("\nMédias gerais:")
print(f"Accuracy médio : {np.mean(accuracy_scores):.4f}")
print(f"Precision média: {np.mean(precision_scores):.4f}")
print(f"Recall médio   : {np.mean(recall_scores):.4f}")
print(f"F1 médio       : {np.mean(f1_scores):.4f}")

"""MLP2 = 64,32"""

X = Train_df.drop(columns=["Depression"])
y = Train_df["Depression"]

pipelineMLP2 = Pipeline(steps=[
  ('scaler', StandardScaler()),
  ('smote', SMOTE()),
  ('model', MLPClassifier(
    hidden_layer_sizes=(64, 32),
    batch_size=64,
    max_iter=800,
    alpha=0.01,
    activation='tanh',
    learning_rate_init=0.0001,
    early_stopping=True,
    n_iter_no_change=20)
  )])

kfold = StratifiedKFold(n_splits=10, shuffle=True, random_state=42)

accuracy_scores = []
precision_scores = []
recall_scores = []
f1_scores = []

for train_index, test_index in kfold.split(X, y):
    X_train, X_test = X.iloc[train_index], X.iloc[test_index]
    y_train, y_test = y.iloc[train_index], y.iloc[test_index]

    pipelineMLP2.fit(X_train, y_train)
    predictions = pipelineMLP2.predict(X_test)

    accuracy_scores.append(accuracy_score(y_test, predictions))
    precision_scores.append(precision_score(y_test, predictions, average='macro'))
    recall_scores.append(recall_score(y_test, predictions, average='macro'))
    f1_scores.append(f1_score(y_test, predictions, average='macro'))

print("Resultados das métricas por fold:")
print("-----------------------------------")

for i in range(10):
  print(f"Fold {i+1}:")
  print(f"  Accuracy : {accuracy_scores[i]:.4f}")
  print(f"  Precision: {precision_scores[i]:.4f}")
  print(f"  Recall   : {recall_scores[i]:.4f}")
  print(f"  F1-Score : {f1_scores[i]:.4f}")
  print("-----------------------------------")

print("\nMédias gerais:")
print(f"Accuracy médio : {np.mean(accuracy_scores):.4f}")
print(f"Precision média: {np.mean(precision_scores):.4f}")
print(f"Recall médio   : {np.mean(recall_scores):.4f}")
print(f"F1 médio       : {np.mean(f1_scores):.4f}")

"""MLP3 = 32,16

"""

X = Train_df.drop(columns=["Depression"])
y = Train_df["Depression"]

pipelineMLP3 = Pipeline(steps=[
  ('scaler', StandardScaler()),
  ('smote', SMOTE()),
  ('model', MLPClassifier(
    hidden_layer_sizes=(32,16),
    batch_size=64,
    max_iter=800,
    alpha=0.01,
    activation='relu',
    learning_rate_init=0.0001,
    early_stopping=True,
    n_iter_no_change=20)
  )])

kfold = StratifiedKFold(n_splits=10, shuffle=True, random_state=42)

accuracy_scores = []
precision_scores = []
recall_scores = []
f1_scores = []

for train_index, test_index in kfold.split(X, y):
    X_train, X_test = X.iloc[train_index], X.iloc[test_index]
    y_train, y_test = y.iloc[train_index], y.iloc[test_index]

    pipelineMLP3.fit(X_train, y_train)
    predictions = pipelineMLP3.predict(X_test)

    accuracy_scores.append(accuracy_score(y_test, predictions))
    precision_scores.append(precision_score(y_test, predictions, average='macro'))
    recall_scores.append(recall_score(y_test, predictions, average='macro'))
    f1_scores.append(f1_score(y_test, predictions, average='macro'))

print("Resultados das métricas por fold:")
print("-----------------------------------")

for i in range(10):
  print(f"Fold {i+1}:")
  print(f"  Accuracy : {accuracy_scores[i]:.4f}")
  print(f"  Precision: {precision_scores[i]:.4f}")
  print(f"  Recall   : {recall_scores[i]:.4f}")
  print(f"  F1-Score : {f1_scores[i]:.4f}")
  print("-----------------------------------")

print("\nMédias gerais:")
print(f"Accuracy médio : {np.mean(accuracy_scores):.4f}")
print(f"Precision média: {np.mean(precision_scores):.4f}")
print(f"Recall médio   : {np.mean(recall_scores):.4f}")
print(f"F1 médio       : {np.mean(f1_scores):.4f}")